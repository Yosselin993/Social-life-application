<!-- this loads Bootstrap 5 -->
{% load bootstrap5 %}
<!-- Declaring the document type as HTML5--->
<!DOCTYPE html>
<!-- sets the HTML document language to English -->
<html lang="en">
<!-- This is the head section -->
<head>
    <!-- This sets the character encoding for the document this even includes emojis-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <!-- title is the text that will appear in the browser tab -->
     <!-- let child templates override the title if needed-->
    <title>{% block title %}Home{% endblock %}</title>
    {% bootstrap_css %} <!-- loads Bootstrap CSS -->

    <style>
    /* I define my classes here */
    .box { /* this is my container for the inside of the login box*/
        width: 500px;
        height: 500px;
        background-color: #ffffffcc;
        margin: 100px auto;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        border-radius: 30px; 
    }

    body{
        background: linear-gradient(to right, #fff3e0, #ff9800); /* orange and white */
        min-height: 100vh;
        /*display: flex;
        justify-content: center;*/
        font-family: 'Arial', sans-serif;
        margin: 0; 
        padding: 0;
    }
    .card{
        width: 90%; 
        max-width: 1290px;
        padding: 40px 80px;  /* top/bottom = 20px, left/right = 80px */
        background-color: white;
        border-radius: 12px;
        /*box-shadow: 0 4px 10px #cd696926;*/
        /*border: 1px solid #88808026; */
        margin: 2px auto;
        box-shadow: 0 2px 8px hsla(226, 53%, 65%, 0.383);
    }
    /*Used for "UTRGVconnect" header and logout button*/
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px; /* same as mb-4 */
    }
    /*styles the search formâ€™s container so items line up horizontally with spacing, full width, and some margin below it*/
    .search-form-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 0;
        margin-bottom: 1rem;
        width: 100%;
        align-items: center;
    }

    .search-form-group input[type="search"] {
        flex-grow: 1; 
        height: 38px; 
        margin-top: 0;
        margin-bottom: 0;
    }

    .search-form-group button[type="submit"] {
        width: 100px; 
        flex-shrink: 0;
        height: 38px; 
        margin-top: 0;
        margin-bottom: 0;
    }
    /*Used to to help display Calendar and Browse all buttons side by side with some space between them, and has the same margins */
    .button-container {
        display: flex;
        gap: 15px;
        color: white;
        margin-left: auto;
        margin-right: auto;
    }
    /*layout container*/
    /* Creates a 3-column grid layout with side columns fixed at 3.5in and a flexible center column */
    .main-content-grid{
        display: grid;
        grid-template-columns: 3.5in 1fr 3.5in;
        gap: 20px;
        align-items: start;
        width: 100%;
    }
    /* Styles the left column and stacks its content vertically */
    .left-column{
        grid-column: 1;
        display: flex;
        flex-direction: column;
    }

    /* Styles the central column of the grid */
    .central-column{
        grid-column: 2;
    }
    /*------------------*/
    /*Creating a new 'card' that will store the student tag content*/
    .student-tag{
        width: 3.5in;
        height: 2.2in;
        padding: 10px;
        margin-top: 5px;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 2px 8px hsla(226, 53%, 65%, 0.383);
    }
    /*Used to display the circle with the student tag*/
    .student-photo-placeholder {
        width: 120px;
        height: 120px;
        background-color: #e0e0e0;
        border: 2px solid #ccc;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 0 2px 8px hsla(226, 53%, 65%, 0.383);
        margin-top: 22px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: #888;
    }
    /*Creating a new 'card' that will store the notification content*/
    .notification-box{
        width: 3.5in;
        height: 3.5in;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 2px 8px hsla(226, 53%, 65%, 0.383);
    }
    /*Creating a new 'card' that will store the different clubs the user is a member of, content.*/
    .visit-club-box{
        width: 3.5in;
        height: 5in;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 2px 8px hsla(226, 53%, 65%, 0.383);
        grid-column: 3;
        margin-top: 5px;

    }
    /*style's the color of thw words, center the words within the 'card', and how far down it is from the top of the 'card'*/
    /*Used for both notification-box and visit-club-box*/
    .notification-placeholder{
        color: #0d47a1;
        text-align: center;
        padding: 0;
    }


   /* .search-container { */
       /* float: right; *//* Floats the search form to the right */
       /* margin-left: 20px; *//* Optional: Add some spacing */
  /*  } */
    
   /* .search-results-container { */
        /* If you want results to also be on the right, you can float them too,
           or clear the float if they should appear below the search bar */
       /* float: right;*/
       /* clear: both; */ /* Clear the float to prevent wrapping issues */
   /* } */
   
    

    .student-photo-placeholder {
    width: 150px;
    height: 150px;
    border: 2px solid #aaa;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background-color: #f7f7f7;
    }

    .student-photo-placeholder img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #placeholderText {
        color: #777;
        font-size: 14px;
        position: absolute;
    }

</style>
</head>
<body> 
    <div class="container mt-2">
             <!--only the seletor 'header' is used here but a class from bootstrap that controls to margins from the top-->
      <div class="mb-4 header"> <!-- header content starts -->
            <h1 style="color: #0d47a1; font-size: 30px;">UTRGVconnect</h1>
            <!--<p>Hi, {{ user.username }}! :)</p> -->
            <form method="post" action="{% url 'logout' %}" class="me-2" id="logout-form">
            {% csrf_token %}
            <a href="#" onclick="document.getElementById('logout-form').submit(); return false;" class="logout-link">
            Logout</a>
            </form>
        </div> <!-- header content ends-->

        <div class="mb-2"> <!--class from bootstrap that controls to margins from the top-->
            <div class="card"> <!--Seletor class "card" is called, everthing displayed within card starts here"-->
                <form method="GET" action="{% url 'search' %}" class="search-form-group">
                    <button type="submit" class="btn btn-primary">Search</button>
                    <input type="search" class="form-control" placeholder="Search..." name="search_query" value="{{ request.GET.search_query|default:'' }}">
                </form>
            <div class="button-container">
            <form action = "{% url 'events_calendar' %}"> <!--changed this to now go to the actual calendar--> 
                <button type="submit" class="btn btn-primary" >Event Calendar</button>
            </form>

            <form action = "{% url 'browse_all' %}"> <!--changed this to now go to the actual calendar-->
                <button type="submit" class="btn btn-primary" >Browse All Clubs</button>
            </form>
            </div>

            </div> 
        </div> <!-- card content ends here-->

        <div class="main-content-grid">
            
            <div class="left-column"> <!--information display in the left side of the page starts-->
                 <!-- this is where the tag information will start-->
                <div class="student-tag">
                    <form method="POST" enctype="multipart/form-data" id="photoForm">
                        {% csrf_token %}

                            <!-- Clickable box -->
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div class="student-photo-placeholder" id="photoBox">
                                {% if student.photo %}
                                    <img id="studentPhoto" src="{{ student.photo.url }}" alt="Student photo">
                                    <span id="placeholderText" style="display:none;">Click to upload</span>
                                {% else %}
                                    <img id="studentPhoto" src="" alt="Student photo" style="display:none;">
                                    <span id="placeholderText">Click to upload</span>
                                {% endif %}
                            </div>

                            <div class="student-info" style="display:flex; flex-direction:column;">
                                <span class="student-username" style="font-weight:600;">{{ display_name }}</span>
                                <!--<span class="student-fullname" style="color:#666;">{{ student.user.get_full_name }}</span>-->
                            </div>
                        </div>

                        <!-- Hidden file input -->
                        <input type="file" id="photoUpload" name="photo" accept="image/*" style="display:none;">
                    </form>

                </div> <!-- this is where the tag information will end-->
                
                <div class="notification-box"> <!-- This is where the noification content starts-->
                    <div class="notification-placeholder">
                        <p>Notification</p>
                    </div>
                </div> <!--This is where the noification conten ends-->
                
            </div> <!--information display in the left side of the page ends-->
            <div class="central-column">
                <div class="search-results-container">
                  {% if results %}
                        <ul class="list-group">
                            {% for item in results %}
                                <li class="list-group-item">{{ item.title }} - {{ item.description }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                      {% endif %}
                </div>
            </div> 
            <div class="visit-club-box"> <!--Where the visiting information starts-->
                <div class="notification-placeholder">
                    <p style="font-weight:600;">Your Favorite Clubs</p>
                    {% if favorite_clubs and favorite_clubs.count > 0 %}
                        <div style="margin-top:8px; display:flex; flex-direction:column; gap:12px; align-items:stretch; text-align:left;">
                            {% for fclub in favorite_clubs %}
                                <div class="card" style="padding:10px;">
                                    <div style="display:flex; justify-content:space-between; gap:8px; align-items:flex-start;">
                                        <div>
                                            <h5 style="margin:0;"><a href="{% url 'club_profile' fclub.id %}">{{ fclub.name }}</a></h5>
                                            {% if fclub.meeting_time %}
                                                <div style="font-size:0.9em; color:#555;">{{ fclub.meeting_time }}</div>
                                            {% endif %}
                                        </div>
                                        <div style="display:flex; gap:8px; align-items:center;">
                                            <form method="post" action="{% url 'toggle_favorite' fclub.id %}">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-outline-danger">Unfavorite</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p style="margin-top:8px;">You haven't favorited any clubs yet.</p>
                        <a href="{% url 'browse_all' %}" class="btn btn-sm btn-primary" style="margin-top:8px;">Browse Clubs</a>
                    {% endif %}
                </div>
            </div> <!--Where the visiting information ends-->
        </div> 
    </div> {% bootstrap_javascript %}

    {% if user.clubs_led.first and not user.clubs_led.first.first_login_completed %}
    <div class="modal fade" id="clubFirstLoginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Complete Your Club Profile</h5>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'club_first_login' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {% if club_form %}
                        {% bootstrap_form club_form %}
                    {% else %}
                        {# Fallback: show the general form variable if present #}
                        {% bootstrap_form form %}
                    {% endif %}
                    <button type="submit" class="btn btn-success mt-2">Save & Continue</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    var myModal = new bootstrap.Modal(document.getElementById('clubFirstLoginModal'));
    myModal.show();
</script>
{% endif %}



<!--this section is for the quiz (recommendation banner)-->
<!--quiz banner with not any background -->
<div class="text-center mt-5 mb-5" style="background: none; border: none; padding: 0;">
    <h3 style="font-weight: bold;">Need recommendations?</h3>
    <p style="font-size: 18px;">Take this quiz to find out what three clubs you should favorite!</p>

    <a href="{% url 'quiz' %}" class="btn btn-primary btn-lg">
        Take the Quiz
    </a>
</div>


</body>
</html>

<script>
const photoBox = document.getElementById("photoBox");
const photoUpload = document.getElementById("photoUpload");
const studentPhoto = document.getElementById("studentPhoto");
const placeholderText = document.getElementById("placeholderText");
const photoForm = document.getElementById("photoForm");

// Click opens file dialog
photoBox.addEventListener("click", () => {
    photoUpload.click();
});

// Preview selected image instantly and auto-submit
photoUpload.addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (file) {
        studentPhoto.src = URL.createObjectURL(file);
        studentPhoto.style.display = "block";
        placeholderText.style.display = "none";
        // Auto-submit the form
        photoForm.submit();
    }
});
</script>


